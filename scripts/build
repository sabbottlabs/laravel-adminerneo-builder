#!/usr/bin/env php
<?php

require __DIR__ . '/../src/Builder.php';

use SabbottLabs\AdminerNeoBuilder\Builder;

// Clean output directory
$outputDir = __DIR__ . '/../output';
if (is_dir($outputDir)) {
    foreach (glob($outputDir . '/*') as $file) {
        unlink($file);
    }
    rmdir($outputDir);
}
mkdir($outputDir, 0755, true);

$config = require __DIR__ . '/../config/build.php';
$builder = new Builder($config);

echo "Building AdminerNeo v5...\n";

if (!$builder->build()) {
    foreach ($builder->getErrors() as $error) {
        fwrite(STDERR, "ERROR: {$error}\n");
    }
    exit(1);
}

echo "Build successful: " . $builder->getOutputDir() . "\n";
exit(0);